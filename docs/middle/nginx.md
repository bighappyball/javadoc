1. ### **Nginx**

**正向代理与反向代理**

正向代理和反向代理的用途都是代理服务中进行客户端请求的转发，但是区别还是很大的。

- 正向代理最大的特点是客户端非常明确要访问的服务器地址
- 反向代理与正向代理相反，客户端不知道目标服务器的信息，代理服务器就像是原始的目标服务器，客户端不需要进行任何特别的设置。

**Reactor 模型**

Nginx 对高并发 IO 的处理使用了 Reactor 事件驱动模型。Reactor 模型的基本组件包含事件收集器、事件发送器、事件处理器 3 个基本单元，其核心思想是将所有要处理的 I/O 事件注册到一个中心 I/O 多路复用器上，同时主线程/进程阻塞在多路复用器上，一旦有 I/O 事件到来或者准备就绪（文件描述符或 Socket 可读、写），多路复用器返回并将事先注册的相应 I/O 事件分发到对应的处理器中

- 事件收集器：负责收集 Worker 进程的各种 I/O 请求。
- 事件发送器：负责将 I/O 事件发送到事件处理器。
- 事件处理器：负责各种事件的响应工作

​                 ![img](https://wdcdn.qpic.cn/MTY4ODg1MTI2MTkxMzIyMQ_449528_tcma6yD4loisBiB2_1657266597?w=1253&h=734)        



事件收集器将各个连接通道的 IO 事件放入一个待处理事件列，通过事件发送器发送给对应的事件处理器来处理。而事件收集器之所以能够同时管理上百万连接通道的事件，是基于操作系统提供的“多路 IO 复用”技术，常见的包括 select、epoll 两种模型

**Nginx 的两类进程**

一般来说，Nginx 在启动后会以 daemon 方式在后台运行，其后台进程有两类：一类称为 Master进程（相当于管理进程）；另一类称为 Worker 进程（工作进程）。

**Nginx 的请求处理流程**

Nginx 中 HTTP 请求的处理流程可以分为 4 步：

（1）读取解析请求行。

（2）读取解析请求头。

（3）多阶段处理，也就是执行 handler 处理器列表。

1. 将结果返回给客户端

Linux 系统下，select 类型 IO 多路复用模型有两个较大的缺陷：

缺陷之一，单服务进程并发数不够，默认最大的客户端连接数为 1024/2048，因为 Linux 系统一个进程所打开的 FD 文件描述符是有限制的，由 FD_SETSIZE 设置，默认值是 1024/2048，因此 select 模型的最大并发数被相应限制了；

缺陷之二，性能问题，每次 IO 事件查询都会线性扫描全部的 FD 集合，连接数越大，性能越会线性下降。总之，select 类型 IO 多路复用模型的性能是不高的。使用 Nginx 的目标之一是为了高性能和高并发。

所以，在 Linux 系统下建议使用 epoll 类型的 IO 多路复用模型。

**location 路由规则配置详解**

精准匹配  如果请求 URI 和精准匹配的模式字符串/lua 完全相同，那么精准匹配通过。在所有的匹配类型中，精准匹配的优先级最高。

 location = /lua {

 echo "hit location: =/Lua";

}

普通匹配  普通匹配的符号标记为“^~”  普通匹配属于字符串前缀匹配，详细来说：如果请求路径 URI 头部匹配到 location 的模式字符串，那么匹配成功。如果匹配到多个前缀，那么最长模式匹配优先。

location ^~ /lua {

 echo "hit location: ^~ /lua";

 }

 正则匹配

默认根路径匹配